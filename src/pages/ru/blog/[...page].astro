---
import PostsList from "../../../layouts/PostsList.astro";
import {getPages} from "../../../utils/getPages.js";
import SITE_CONFIG from "../../../site.config";
import { useTranslations } from '../../../i18n/utils';

export async function getStaticPaths({paginate}) {
    let allPosts = [];
    try {
        const posts = import.meta.glob<{frontmatter: any}>('/src/pages/**/*.md', { eager: true });
        allPosts = Object.entries(posts).map(([filepath, post]) => ({
            ...post,
            file: filepath
        }));
    } catch (error) {
        console.error("No markdown files found:", error);
    }

    const pages = getPages(allPosts, 'blog', 'ru');
    return paginate(pages, {pageSize: SITE_CONFIG.postsPerPage || 10});
}

const {page} = Astro.props;
const t = useTranslations('ru');
---
<PostsList category={t('ui.blog')} title={`${SITE_CONFIG.title.ru}: ${t('ui.blog_posts')}`} description={t('ui.blog_description')} page={page} allPosts={page.data} />
